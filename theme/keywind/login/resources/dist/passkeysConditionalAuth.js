import{b as o}from"./assets/rfc4648-22fd5bf4.js";import{returnSuccess as r,signal as l}from"./webAuthnAuthenticate.js";import"./assets/module.esm-1a8ca6bf.js";function y(e,i=()=>{}){window.PublicKeyCredential&&(e.isUserIdentified||typeof PublicKeyCredential.isConditionalMediationAvailable>"u"?i(!1):d(e,i))}async function s(e){if(!window.PublicKeyCredential)throw new Error("WebAuthn not supported");const i={rpId:e.rpId,challenge:new Uint8Array(o.parse(e.challenge,{loose:!0}))};return i.allowCredentials=e.isUserIdentified?c():[],e.createTimeout!==0&&(i.timeout=e.createTimeout*1e3),e.userVerification!=="not specified"&&(i.userVerification=e.userVerification),navigator.credentials.get({publicKey:i,signal:l(),...e.additionalOptions})}async function d(e,i=()=>{}){if(await PublicKeyCredential.isConditionalMediationAvailable()){i(!0),e.additionalOptions={mediation:"conditional"};try{const n=await s(e);r(n)}catch{}}else i(!1)}function c(){const e=[],i=document.forms.namedItem("authn_select");if(i){const t=i.elements.namedItem("authn_use_chk");if(t!=null){if(t instanceof HTMLInputElement)e.push({id:new Uint8Array(o.parse(t.value,{loose:!0})),type:"public-key"});else if(t.length!==void 0)for(let n=0;n<t.length;n++){const a=t[n];e.push({id:new Uint8Array(o.parse(a.value,{loose:!0})),type:"public-key"})}}}return e}export{y as initAuthenticate};
